/*
-----------------------------------------------------------------------------
This source file is part of Indigente Game Engine
Indigente - Interactive Digital Entertainment
For the latest info, see http://twiki.im.ufba.br/bin/view/Indigente

Copyright  2004-2006 Indigente


This program is free software; you can redistribute it and/or modify it under
the terms of the GNU Lesser General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 59 Temple
Place - Suite 330, Boston, MA 02111-1307, USA, or go to
http://www.gnu.org/copyleft/lesser.txt.
-----------------------------------------------------------------------------
*/
#include "Md2model.h"
#include "../../../Base/MeshDecorator/ConcreteMesh.h"
#include "../../../Base/Vertex.h"
#include <iostream>
using namespace std;
namespace InGE {
anim_t Md2Model::m_animlist[21]= {
    			// first, last, fps

	 {   0,  39,  9 },   // STAND
	 {  40,  45, 10 },   // RUN
	 {  46,  53, 10 },   // ATTACK
	 {  54,  57,  7 },   // PAIN_A
	 {  58,  61,  7 },   // PAIN_B
	 {  62,  65,  7 },   // PAIN_C
	 {  66,  71,  7 },   // JUMP
	 {  72,  83,  7 },   // FLIP
	 {  84,  94,  7 },   // SALUTE
	 {  95, 111, 10 },   // FALLBACK
	 { 112, 122,  7 },   // WAVE
	 { 123, 134,  6 },   // POINT
	 { 135, 153, 10 },   // CROUCH_STAND
	 { 154, 159,  7 },   // CROUCH_WALK
	 { 160, 168, 10 },   // CROUCH_ATTACK
	 { 196, 172,  7 },   // CROUCH_PAIN
	 { 173, 177,  5 },   // CROUCH_DEATH
	 { 178, 183,  7 },   // DEATH_FALLBACK
	 { 184, 189,  7 },   // DEATH_FALLFORWARD
	 { 190, 197,  7 },   // DEATH_FALLBACKSLOW
	 { 198, 198,  5 },   // BOOM
 };
	Md2Model::Md2Model(){
		m_vertices      = 0;
		m_glcmds        = 0;
		m_lightnormals  = 0;

		num_frames      = 0;
		num_xyz         = 0;
		num_glcmds      = 0;

		m_texid         = 0;
		m_scale         = 1.0;
		SetAnim( 0 );
		
		static vec3_t   anorms[ 162 ] = {
			{ -0.525731f,  0.000000f,  0.850651f }, 
			{ -0.442863f,  0.238856f,  0.864188f }, 
			{ -0.295242f,  0.000000f,  0.955423f }, 
			{ -0.309017f,  0.500000f,  0.809017f }, 
			{ -0.162460f,  0.262866f,  0.951056f }, 
			{  0.000000f,  0.000000f,  1.000000f }, 
			{  0.000000f,  0.850651f,  0.525731f }, 
			{ -0.147621f,  0.716567f,  0.681718f }, 
			{  0.147621f,  0.716567f,  0.681718f }, 
			{  0.000000f,  0.525731f,  0.850651f }, 
			{  0.309017f,  0.500000f,  0.809017f }, 
			{  0.525731f,  0.000000f,  0.850651f }, 
			{  0.295242f,  0.000000f,  0.955423f }, 
			{  0.442863f,  0.238856f,  0.864188f }, 
			{  0.162460f,  0.262866f,  0.951056f }, 
			{ -0.681718f,  0.147621f,  0.716567f }, 
			{ -0.809017f,  0.309017f,  0.500000f }, 
			{ -0.587785f,  0.425325f,  0.688191f }, 
			{ -0.850651f,  0.525731f,  0.000000f }, 
			{ -0.864188f,  0.442863f,  0.238856f }, 
			{ -0.716567f,  0.681718f,  0.147621f }, 
			{ -0.688191f,  0.587785f,  0.425325f }, 
			{ -0.500000f,  0.809017f,  0.309017f }, 
			{ -0.238856f,  0.864188f,  0.442863f }, 
			{ -0.425325f,  0.688191f,  0.587785f }, 
			{ -0.716567f,  0.681718f, -0.147621f }, 
			{ -0.500000f,  0.809017f, -0.309017f }, 
			{ -0.525731f,  0.850651f,  0.000000f }, 
			{  0.000000f,  0.850651f, -0.525731f }, 
			{ -0.238856f,  0.864188f, -0.442863f }, 
			{  0.000000f,  0.955423f, -0.295242f }, 
			{ -0.262866f,  0.951056f, -0.162460f }, 
			{  0.000000f,  1.000000f,  0.000000f }, 
			{  0.000000f,  0.955423f,  0.295242f }, 
			{ -0.262866f,  0.951056f,  0.162460f }, 
			{  0.238856f,  0.864188f,  0.442863f }, 
			{  0.262866f,  0.951056f,  0.162460f }, 
			{  0.500000f,  0.809017f,  0.309017f }, 
			{  0.238856f,  0.864188f, -0.442863f }, 
			{  0.262866f,  0.951056f, -0.162460f }, 
			{  0.500000f,  0.809017f, -0.309017f }, 
			{  0.850651f,  0.525731f,  0.000000f }, 
			{  0.716567f,  0.681718f,  0.147621f }, 
			{  0.716567f,  0.681718f, -0.147621f }, 
			{  0.525731f,  0.850651f,  0.000000f }, 
			{  0.425325f,  0.688191f,  0.587785f }, 
			{  0.864188f,  0.442863f,  0.238856f }, 
			{  0.688191f,  0.587785f,  0.425325f }, 
			{  0.809017f,  0.309017f,  0.500000f }, 
			{  0.681718f,  0.147621f,  0.716567f }, 
			{  0.587785f,  0.425325f,  0.688191f }, 
			{  0.955423f,  0.295242f,  0.000000f }, 
			{  1.000000f,  0.000000f,  0.000000f }, 
			{  0.951056f,  0.162460f,  0.262866f }, 
			{  0.850651f, -0.525731f,  0.000000f }, 
			{  0.955423f, -0.295242f,  0.000000f }, 
			{  0.864188f, -0.442863f,  0.238856f }, 
			{  0.951056f, -0.162460f,  0.262866f }, 
			{  0.809017f, -0.309017f,  0.500000f }, 
			{  0.681718f, -0.147621f,  0.716567f }, 
			{  0.850651f,  0.000000f,  0.525731f }, 
			{  0.864188f,  0.442863f, -0.238856f }, 
			{  0.809017f,  0.309017f, -0.500000f }, 
			{  0.951056f,  0.162460f, -0.262866f }, 
			{  0.525731f,  0.000000f, -0.850651f }, 
			{  0.681718f,  0.147621f, -0.716567f }, 
			{  0.681718f, -0.147621f, -0.716567f }, 
			{  0.850651f,  0.000000f, -0.525731f }, 
			{  0.809017f, -0.309017f, -0.500000f }, 
			{  0.864188f, -0.442863f, -0.238856f }, 
			{  0.951056f, -0.162460f, -0.262866f }, 
			{  0.147621f,  0.716567f, -0.681718f }, 
			{  0.309017f,  0.500000f, -0.809017f }, 
			{  0.425325f,  0.688191f, -0.587785f }, 
			{  0.442863f,  0.238856f, -0.864188f }, 
			{  0.587785f,  0.425325f, -0.688191f }, 
			{  0.688191f,  0.587785f, -0.425325f }, 
			{ -0.147621f,  0.716567f, -0.681718f }, 
			{ -0.309017f,  0.500000f, -0.809017f }, 
			{  0.000000f,  0.525731f, -0.850651f }, 
			{ -0.525731f,  0.000000f, -0.850651f }, 
			{ -0.442863f,  0.238856f, -0.864188f }, 
			{ -0.295242f,  0.000000f, -0.955423f }, 
			{ -0.162460f,  0.262866f, -0.951056f }, 
			{  0.000000f,  0.000000f, -1.000000f }, 
			{  0.295242f,  0.000000f, -0.955423f }, 
			{  0.162460f,  0.262866f, -0.951056f }, 
			{ -0.442863f, -0.238856f, -0.864188f }, 
			{ -0.309017f, -0.500000f, -0.809017f }, 
			{ -0.162460f, -0.262866f, -0.951056f }, 
			{  0.000000f, -0.850651f, -0.525731f }, 
			{ -0.147621f, -0.716567f, -0.681718f }, 
			{  0.147621f, -0.716567f, -0.681718f }, 
			{  0.000000f, -0.525731f, -0.850651f }, 
			{  0.309017f, -0.500000f, -0.809017f }, 
			{  0.442863f, -0.238856f, -0.864188f }, 
			{  0.162460f, -0.262866f, -0.951056f }, 
			{  0.238856f, -0.864188f, -0.442863f }, 
			{  0.500000f, -0.809017f, -0.309017f }, 
			{  0.425325f, -0.688191f, -0.587785f }, 
			{  0.716567f, -0.681718f, -0.147621f }, 
			{  0.688191f, -0.587785f, -0.425325f }, 
			{  0.587785f, -0.425325f, -0.688191f }, 
			{  0.000000f, -0.955423f, -0.295242f }, 
			{  0.000000f, -1.000000f,  0.000000f }, 
			{  0.262866f, -0.951056f, -0.162460f }, 
			{  0.000000f, -0.850651f,  0.525731f }, 
			{  0.000000f, -0.955423f,  0.295242f }, 
			{  0.238856f, -0.864188f,  0.442863f }, 
			{  0.262866f, -0.951056f,  0.162460f }, 
			{  0.500000f, -0.809017f,  0.309017f }, 
			{  0.716567f, -0.681718f,  0.147621f }, 
			{  0.525731f, -0.850651f,  0.000000f }, 
			{ -0.238856f, -0.864188f, -0.442863f }, 
			{ -0.500000f, -0.809017f, -0.309017f }, 
			{ -0.262866f, -0.951056f, -0.162460f }, 
			{ -0.850651f, -0.525731f,  0.000000f }, 
			{ -0.716567f, -0.681718f, -0.147621f }, 
			{ -0.716567f, -0.681718f,  0.147621f }, 
			{ -0.525731f, -0.850651f,  0.000000f }, 
			{ -0.500000f, -0.809017f,  0.309017f }, 
			{ -0.238856f, -0.864188f,  0.442863f }, 
			{ -0.262866f, -0.951056f,  0.162460f }, 
			{ -0.864188f, -0.442863f,  0.238856f }, 
			{ -0.809017f, -0.309017f,  0.500000f }, 
			{ -0.688191f, -0.587785f,  0.425325f }, 
			{ -0.681718f, -0.147621f,  0.716567f }, 
			{ -0.442863f, -0.238856f,  0.864188f }, 
			{ -0.587785f, -0.425325f,  0.688191f }, 
			{ -0.309017f, -0.500000f,  0.809017f }, 
			{ -0.147621f, -0.716567f,  0.681718f }, 
			{ -0.425325f, -0.688191f,  0.587785f }, 
			{ -0.162460f, -0.262866f,  0.951056f }, 
			{  0.442863f, -0.238856f,  0.864188f }, 
			{  0.162460f, -0.262866f,  0.951056f }, 
			{  0.309017f, -0.500000f,  0.809017f }, 
			{  0.147621f, -0.716567f,  0.681718f }, 
			{  0.000000f, -0.525731f,  0.850651f }, 
			{  0.425325f, -0.688191f,  0.587785f }, 
			{  0.587785f, -0.425325f,  0.688191f }, 
			{  0.688191f, -0.587785f,  0.425325f }, 
			{ -0.955423f,  0.295242f,  0.000000f }, 
			{ -0.951056f,  0.162460f,  0.262866f }, 
			{ -1.000000f,  0.000000f,  0.000000f }, 
			{ -0.850651f,  0.000000f,  0.525731f }, 
			{ -0.955423f, -0.295242f,  0.000000f }, 
			{ -0.951056f, -0.162460f,  0.262866f }, 
			{ -0.864188f,  0.442863f, -0.238856f }, 
			{ -0.951056f,  0.162460f, -0.262866f }, 
			{ -0.809017f,  0.309017f, -0.500000f }, 
			{ -0.864188f, -0.442863f, -0.238856f }, 
			{ -0.951056f, -0.162460f, -0.262866f }, 
			{ -0.809017f, -0.309017f, -0.500000f }, 
			{ -0.681718f,  0.147621f, -0.716567f }, 
			{ -0.681718f, -0.147621f, -0.716567f }, 
			{ -0.850651f,  0.000000f, -0.525731f }, 
			{ -0.688191f,  0.587785f, -0.425325f }, 
			{ -0.587785f,  0.425325f, -0.688191f }, 
			{ -0.425325f,  0.688191f, -0.587785f }, 
			{ -0.425325f, -0.688191f, -0.587785f }, 
			{ -0.587785f, -0.425325f, -0.688191f }, 
			{ -0.688191f, -0.587785f, -0.425325f } 
		};

		// precalculated dot product results
		static float    anorms_dots[16][256] = {
			{1.23,1.30,1.47,1.35,1.56,1.71,1.37,1.38,1.59,1.60,1.79,1.97,1.88,1.92,1.79,1.02,0.93,1.07,0.82,0.87,0.88,0.94,0.96,1.14,1.11,0.82,0.83,0.89,0.89,0.86,0.94,0.91,1.00,1.21,0.98,1.48,1.30,1.57,0.96,1.07,1.14,1.60,1.61,1.40,1.37,1.72,1.78,1.79,1.93,1.99,1.90,1.68,1.71,1.86,1.60,1.68,1.78,1.86,1.93,1.99,1.97,1.44,1.22,1.49,0.93,0.99,0.99,1.23,1.22,1.44,1.49,0.89,0.89,0.97,0.91,0.98,1.19,0.82,0.76,0.82,0.71,0.72,0.73,0.76,0.79,0.86,0.83,0.72,0.76,0.76,0.89,0.82,0.89,0.82,0.89,0.91,0.83,0.96,1.14,0.97,1.40,1.19,0.98,0.94,1.00,1.07,1.37,1.21,1.48,1.30,1.57,1.61,1.37,0.86,0.83,0.91,0.82,0.82,0.88,0.89,0.96,1.14,0.98,0.87,0.93,0.94,1.02,1.30,1.07,1.35,1.38,1.11,1.56,1.92,1.79,1.79,1.59,1.60,1.72,1.90,1.79,0.80,0.85,0.79,0.93,0.80,0.85,0.77,0.74,0.72,0.77,0.74,0.72,0.70,0.70,0.71,0.76,0.73,0.79,0.79,0.73,0.76,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.26,1.26,1.48,1.23,1.50,1.71,1.14,1.19,1.38,1.46,1.64,1.94,1.87,1.84,1.71,1.02,0.92,1.00,0.79,0.85,0.84,0.91,0.90,0.98,0.99,0.77,0.77,0.83,0.82,0.79,0.86,0.84,0.92,0.99,0.91,1.24,1.03,1.33,0.88,0.94,0.97,1.41,1.39,1.18,1.11,1.51,1.61,1.59,1.80,1.91,1.76,1.54,1.65,1.76,1.70,1.70,1.85,1.85,1.97,1.99,1.93,1.28,1.09,1.39,0.92,0.97,0.99,1.18,1.26,1.52,1.48,0.83,0.85,0.90,0.88,0.93,1.00,0.77,0.73,0.78,0.72,0.71,0.74,0.75,0.79,0.86,0.81,0.75,0.81,0.79,0.96,0.88,0.94,0.86,0.93,0.92,0.85,1.08,1.33,1.05,1.55,1.31,1.01,1.05,1.27,1.31,1.60,1.47,1.70,1.54,1.76,1.76,1.57,0.93,0.90,0.99,0.88,0.88,0.95,0.97,1.11,1.39,1.20,0.92,0.97,1.01,1.10,1.39,1.22,1.51,1.58,1.32,1.64,1.97,1.85,1.91,1.77,1.74,1.88,1.99,1.91,0.79,0.86,0.80,0.94,0.84,0.88,0.74,0.74,0.71,0.82,0.77,0.76,0.70,0.73,0.72,0.73,0.70,0.74,0.85,0.77,0.82,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.34,1.27,1.53,1.17,1.46,1.71,0.98,1.05,1.20,1.34,1.48,1.86,1.82,1.71,1.62,1.09,0.94,0.99,0.79,0.85,0.82,0.90,0.87,0.93,0.96,0.76,0.74,0.79,0.76,0.74,0.79,0.78,0.85,0.92,0.85,1.00,0.93,1.06,0.81,0.86,0.89,1.16,1.12,0.97,0.95,1.28,1.38,1.35,1.60,1.77,1.57,1.33,1.50,1.58,1.69,1.63,1.82,1.74,1.91,1.92,1.80,1.04,0.97,1.21,0.90,0.93,0.97,1.05,1.21,1.48,1.37,0.77,0.80,0.84,0.85,0.88,0.92,0.73,0.71,0.74,0.74,0.71,0.75,0.73,0.79,0.84,0.78,0.79,0.86,0.81,1.05,0.94,0.99,0.90,0.95,0.92,0.86,1.24,1.44,1.14,1.59,1.34,1.02,1.27,1.50,1.49,1.80,1.69,1.86,1.72,1.87,1.80,1.69,1.00,0.98,1.23,0.95,0.96,1.09,1.16,1.37,1.63,1.46,0.99,1.10,1.25,1.24,1.51,1.41,1.67,1.77,1.55,1.72,1.95,1.89,1.98,1.91,1.86,1.97,1.99,1.94,0.81,0.89,0.85,0.98,0.90,0.94,0.75,0.78,0.73,0.89,0.83,0.82,0.72,0.77,0.76,0.72,0.70,0.71,0.91,0.83,0.89,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.46,1.34,1.60,1.16,1.46,1.71,0.94,0.99,1.05,1.26,1.33,1.74,1.76,1.57,1.54,1.23,0.98,1.05,0.83,0.89,0.84,0.92,0.87,0.91,0.96,0.78,0.74,0.79,0.72,0.72,0.75,0.76,0.80,0.88,0.83,0.94,0.87,0.95,0.76,0.80,0.82,0.97,0.96,0.89,0.88,1.08,1.11,1.10,1.37,1.59,1.37,1.07,1.27,1.34,1.57,1.45,1.69,1.55,1.77,1.79,1.60,0.93,0.90,0.99,0.86,0.87,0.93,0.96,1.07,1.35,1.18,0.73,0.76,0.77,0.81,0.82,0.85,0.70,0.71,0.72,0.78,0.73,0.77,0.73,0.79,0.82,0.76,0.83,0.90,0.84,1.18,0.98,1.03,0.92,0.95,0.90,0.86,1.32,1.45,1.15,1.53,1.27,0.99,1.42,1.65,1.58,1.93,1.83,1.94,1.81,1.88,1.74,1.70,1.19,1.17,1.44,1.11,1.15,1.36,1.41,1.61,1.81,1.67,1.22,1.34,1.50,1.42,1.65,1.61,1.82,1.91,1.75,1.80,1.89,1.89,1.98,1.99,1.94,1.98,1.92,1.87,0.86,0.95,0.92,1.14,0.98,1.03,0.79,0.84,0.77,0.97,0.90,0.89,0.76,0.82,0.82,0.74,0.72,0.71,0.98,0.89,0.97,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.60,1.44,1.68,1.22,1.49,1.71,0.93,0.99,0.99,1.23,1.22,1.60,1.68,1.44,1.49,1.40,1.14,1.19,0.89,0.96,0.89,0.97,0.89,0.91,0.98,0.82,0.76,0.82,0.71,0.72,0.73,0.76,0.79,0.86,0.83,0.91,0.83,0.89,0.72,0.76,0.76,0.89,0.89,0.82,0.82,0.98,0.96,0.97,1.14,1.40,1.19,0.94,1.00,1.07,1.37,1.21,1.48,1.30,1.57,1.61,1.37,0.86,0.83,0.91,0.82,0.82,0.88,0.89,0.96,1.14,0.98,0.70,0.72,0.73,0.77,0.76,0.79,0.70,0.72,0.71,0.82,0.77,0.80,0.74,0.79,0.80,0.74,0.87,0.93,0.85,1.23,1.02,1.02,0.93,0.93,0.87,0.85,1.30,1.35,1.07,1.38,1.11,0.94,1.47,1.71,1.56,1.97,1.88,1.92,1.79,1.79,1.59,1.60,1.30,1.35,1.56,1.37,1.38,1.59,1.60,1.79,1.92,1.79,1.48,1.57,1.72,1.61,1.78,1.79,1.93,1.99,1.90,1.86,1.78,1.86,1.93,1.99,1.97,1.90,1.79,1.72,0.94,1.07,1.00,1.37,1.21,1.30,0.86,0.91,0.83,1.14,0.98,0.96,0.82,0.88,0.89,0.79,0.76,0.73,1.07,0.94,1.11,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.74,1.57,1.76,1.33,1.54,1.71,0.94,1.05,0.99,1.26,1.16,1.46,1.60,1.34,1.46,1.59,1.37,1.37,0.97,1.11,0.96,1.10,0.95,0.94,1.08,0.89,0.82,0.88,0.72,0.76,0.75,0.80,0.80,0.88,0.87,0.91,0.83,0.87,0.72,0.76,0.74,0.83,0.84,0.78,0.79,0.96,0.89,0.92,0.98,1.23,1.05,0.86,0.92,0.95,1.11,0.98,1.22,1.03,1.34,1.42,1.14,0.79,0.77,0.84,0.78,0.76,0.82,0.82,0.89,0.97,0.90,0.70,0.71,0.71,0.73,0.72,0.74,0.73,0.76,0.72,0.86,0.81,0.82,0.76,0.79,0.77,0.73,0.90,0.95,0.86,1.18,1.03,0.98,0.92,0.90,0.83,0.84,1.19,1.17,0.98,1.15,0.97,0.89,1.42,1.65,1.44,1.93,1.83,1.81,1.67,1.61,1.36,1.41,1.32,1.45,1.58,1.57,1.53,1.74,1.70,1.88,1.94,1.81,1.69,1.77,1.87,1.79,1.89,1.92,1.98,1.99,1.98,1.89,1.65,1.80,1.82,1.91,1.94,1.75,1.61,1.50,1.07,1.34,1.27,1.60,1.45,1.55,0.93,0.99,0.90,1.35,1.18,1.07,0.87,0.93,0.96,0.85,0.82,0.77,1.15,0.99,1.27,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.86,1.71,1.82,1.48,1.62,1.71,0.98,1.20,1.05,1.34,1.17,1.34,1.53,1.27,1.46,1.77,1.60,1.57,1.16,1.38,1.12,1.35,1.06,1.00,1.28,0.97,0.89,0.95,0.76,0.81,0.79,0.86,0.85,0.92,0.93,0.93,0.85,0.87,0.74,0.78,0.74,0.79,0.82,0.76,0.79,0.96,0.85,0.90,0.94,1.09,0.99,0.81,0.85,0.89,0.95,0.90,0.99,0.94,1.10,1.24,0.98,0.75,0.73,0.78,0.74,0.72,0.77,0.76,0.82,0.89,0.83,0.73,0.71,0.71,0.71,0.70,0.72,0.77,0.80,0.74,0.90,0.85,0.84,0.78,0.79,0.75,0.73,0.92,0.95,0.86,1.05,0.99,0.94,0.90,0.86,0.79,0.81,1.00,0.98,0.91,0.96,0.89,0.83,1.27,1.50,1.23,1.80,1.69,1.63,1.46,1.37,1.09,1.16,1.24,1.44,1.49,1.69,1.59,1.80,1.69,1.87,1.86,1.72,1.82,1.91,1.94,1.92,1.95,1.99,1.98,1.91,1.97,1.89,1.51,1.72,1.67,1.77,1.86,1.55,1.41,1.25,1.33,1.58,1.50,1.80,1.63,1.74,1.04,1.21,0.97,1.48,1.37,1.21,0.93,0.97,1.05,0.92,0.88,0.84,1.14,1.02,1.34,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.94,1.84,1.87,1.64,1.71,1.71,1.14,1.38,1.19,1.46,1.23,1.26,1.48,1.26,1.50,1.91,1.80,1.76,1.41,1.61,1.39,1.59,1.33,1.24,1.51,1.18,0.97,1.11,0.82,0.88,0.86,0.94,0.92,0.99,1.03,0.98,0.91,0.90,0.79,0.84,0.77,0.79,0.84,0.77,0.83,0.99,0.85,0.91,0.92,1.02,1.00,0.79,0.80,0.86,0.88,0.84,0.92,0.88,0.97,1.10,0.94,0.74,0.71,0.74,0.72,0.70,0.73,0.72,0.76,0.82,0.77,0.77,0.73,0.74,0.71,0.70,0.73,0.83,0.85,0.78,0.92,0.88,0.86,0.81,0.79,0.74,0.75,0.92,0.93,0.85,0.96,0.94,0.88,0.86,0.81,0.75,0.79,0.93,0.90,0.85,0.88,0.82,0.77,1.05,1.27,0.99,1.60,1.47,1.39,1.20,1.11,0.95,0.97,1.08,1.33,1.31,1.70,1.55,1.76,1.57,1.76,1.70,1.54,1.85,1.97,1.91,1.99,1.97,1.99,1.91,1.77,1.88,1.85,1.39,1.64,1.51,1.58,1.74,1.32,1.22,1.01,1.54,1.76,1.65,1.93,1.70,1.85,1.28,1.39,1.09,1.52,1.48,1.26,0.97,0.99,1.18,1.00,0.93,0.90,1.05,1.01,1.31,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.97,1.92,1.88,1.79,1.79,1.71,1.37,1.59,1.38,1.60,1.35,1.23,1.47,1.30,1.56,1.99,1.93,1.90,1.60,1.78,1.61,1.79,1.57,1.48,1.72,1.40,1.14,1.37,0.89,0.96,0.94,1.07,1.00,1.21,1.30,1.14,0.98,0.96,0.86,0.91,0.83,0.82,0.88,0.82,0.89,1.11,0.87,0.94,0.93,1.02,1.07,0.80,0.79,0.85,0.82,0.80,0.87,0.85,0.93,1.02,0.93,0.77,0.72,0.74,0.71,0.70,0.70,0.71,0.72,0.77,0.74,0.82,0.76,0.79,0.72,0.73,0.76,0.89,0.89,0.82,0.93,0.91,0.86,0.83,0.79,0.73,0.76,0.91,0.89,0.83,0.89,0.89,0.82,0.82,0.76,0.72,0.76,0.86,0.83,0.79,0.82,0.76,0.73,0.94,1.00,0.91,1.37,1.21,1.14,0.98,0.96,0.88,0.89,0.96,1.14,1.07,1.60,1.40,1.61,1.37,1.57,1.48,1.30,1.78,1.93,1.79,1.99,1.92,1.90,1.79,1.59,1.72,1.79,1.30,1.56,1.35,1.38,1.60,1.11,1.07,0.94,1.68,1.86,1.71,1.97,1.68,1.86,1.44,1.49,1.22,1.44,1.49,1.22,0.99,0.99,1.23,1.19,0.98,0.97,0.97,0.98,1.19,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.94,1.97,1.87,1.91,1.85,1.71,1.60,1.77,1.58,1.74,1.51,1.26,1.48,1.39,1.64,1.99,1.97,1.99,1.70,1.85,1.76,1.91,1.76,1.70,1.88,1.55,1.33,1.57,0.96,1.08,1.05,1.31,1.27,1.47,1.54,1.39,1.20,1.11,0.93,0.99,0.90,0.88,0.95,0.88,0.97,1.32,0.92,1.01,0.97,1.10,1.22,0.84,0.80,0.88,0.79,0.79,0.85,0.86,0.92,1.02,0.94,0.82,0.76,0.77,0.72,0.73,0.70,0.72,0.71,0.74,0.74,0.88,0.81,0.85,0.75,0.77,0.82,0.94,0.93,0.86,0.92,0.92,0.86,0.85,0.79,0.74,0.79,0.88,0.85,0.81,0.82,0.83,0.77,0.78,0.73,0.71,0.75,0.79,0.77,0.74,0.77,0.73,0.70,0.86,0.92,0.84,1.14,0.99,0.98,0.91,0.90,0.84,0.83,0.88,0.97,0.94,1.41,1.18,1.39,1.11,1.33,1.24,1.03,1.61,1.80,1.59,1.91,1.84,1.76,1.64,1.38,1.51,1.71,1.26,1.50,1.23,1.19,1.46,0.99,1.00,0.91,1.70,1.85,1.65,1.93,1.54,1.76,1.52,1.48,1.26,1.28,1.39,1.09,0.99,0.97,1.18,1.31,1.01,1.05,0.90,0.93,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.86,1.95,1.82,1.98,1.89,1.71,1.80,1.91,1.77,1.86,1.67,1.34,1.53,1.51,1.72,1.92,1.91,1.99,1.69,1.82,1.80,1.94,1.87,1.86,1.97,1.59,1.44,1.69,1.05,1.24,1.27,1.49,1.50,1.69,1.72,1.63,1.46,1.37,1.00,1.23,0.98,0.95,1.09,0.96,1.16,1.55,0.99,1.25,1.10,1.24,1.41,0.90,0.85,0.94,0.79,0.81,0.85,0.89,0.94,1.09,0.98,0.89,0.82,0.83,0.74,0.77,0.72,0.76,0.73,0.75,0.78,0.94,0.86,0.91,0.79,0.83,0.89,0.99,0.95,0.90,0.90,0.92,0.84,0.86,0.79,0.75,0.81,0.85,0.80,0.78,0.76,0.77,0.73,0.74,0.71,0.71,0.73,0.74,0.74,0.71,0.76,0.72,0.70,0.79,0.85,0.78,0.98,0.92,0.93,0.85,0.87,0.82,0.79,0.81,0.89,0.86,1.16,0.97,1.12,0.95,1.06,1.00,0.93,1.38,1.60,1.35,1.77,1.71,1.57,1.48,1.20,1.28,1.62,1.27,1.46,1.17,1.05,1.34,0.96,0.99,0.90,1.63,1.74,1.50,1.80,1.33,1.58,1.48,1.37,1.21,1.04,1.21,0.97,0.97,0.93,1.05,1.34,1.02,1.14,0.84,0.88,0.92,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.74,1.89,1.76,1.98,1.89,1.71,1.93,1.99,1.91,1.94,1.82,1.46,1.60,1.65,1.80,1.79,1.77,1.92,1.57,1.69,1.74,1.87,1.88,1.94,1.98,1.53,1.45,1.70,1.18,1.32,1.42,1.58,1.65,1.83,1.81,1.81,1.67,1.61,1.19,1.44,1.17,1.11,1.36,1.15,1.41,1.75,1.22,1.50,1.34,1.42,1.61,0.98,0.92,1.03,0.83,0.86,0.89,0.95,0.98,1.23,1.14,0.97,0.89,0.90,0.78,0.82,0.76,0.82,0.77,0.79,0.84,0.98,0.90,0.98,0.83,0.89,0.97,1.03,0.95,0.92,0.86,0.90,0.82,0.86,0.79,0.77,0.84,0.81,0.76,0.76,0.72,0.73,0.70,0.72,0.71,0.73,0.73,0.72,0.74,0.71,0.78,0.74,0.72,0.75,0.80,0.76,0.94,0.88,0.91,0.83,0.87,0.84,0.79,0.76,0.82,0.80,0.97,0.89,0.96,0.88,0.95,0.94,0.87,1.11,1.37,1.10,1.59,1.57,1.37,1.33,1.05,1.08,1.54,1.34,1.46,1.16,0.99,1.26,0.96,1.05,0.92,1.45,1.55,1.27,1.60,1.07,1.34,1.35,1.18,1.07,0.93,0.99,0.90,0.93,0.87,0.96,1.27,0.99,1.15,0.77,0.82,0.85,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.60,1.78,1.68,1.93,1.86,1.71,1.97,1.99,1.99,1.97,1.93,1.60,1.68,1.78,1.86,1.61,1.57,1.79,1.37,1.48,1.59,1.72,1.79,1.92,1.90,1.38,1.35,1.60,1.23,1.30,1.47,1.56,1.71,1.88,1.79,1.92,1.79,1.79,1.30,1.56,1.35,1.37,1.59,1.38,1.60,1.90,1.48,1.72,1.57,1.61,1.79,1.21,1.00,1.30,0.89,0.94,0.96,1.07,1.14,1.40,1.37,1.14,0.96,0.98,0.82,0.88,0.82,0.89,0.83,0.86,0.91,1.02,0.93,1.07,0.87,0.94,1.11,1.02,0.93,0.93,0.82,0.87,0.80,0.85,0.79,0.80,0.85,0.77,0.72,0.74,0.71,0.70,0.70,0.71,0.72,0.77,0.74,0.72,0.76,0.73,0.82,0.79,0.76,0.73,0.79,0.76,0.93,0.86,0.91,0.83,0.89,0.89,0.82,0.72,0.76,0.76,0.89,0.82,0.89,0.82,0.89,0.91,0.83,0.96,1.14,0.97,1.40,1.44,1.19,1.22,0.99,0.98,1.49,1.44,1.49,1.22,0.99,1.23,0.98,1.19,0.97,1.21,1.30,1.00,1.37,0.94,1.07,1.14,0.98,0.96,0.86,0.91,0.83,0.88,0.82,0.89,1.11,0.94,1.07,0.73,0.76,0.79,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.46,1.65,1.60,1.82,1.80,1.71,1.93,1.91,1.99,1.94,1.98,1.74,1.76,1.89,1.89,1.42,1.34,1.61,1.11,1.22,1.36,1.50,1.61,1.81,1.75,1.15,1.17,1.41,1.18,1.19,1.42,1.44,1.65,1.83,1.67,1.94,1.81,1.88,1.32,1.58,1.45,1.57,1.74,1.53,1.70,1.98,1.69,1.87,1.77,1.79,1.92,1.45,1.27,1.55,0.97,1.07,1.11,1.34,1.37,1.59,1.60,1.35,1.07,1.18,0.86,0.93,0.87,0.96,0.90,0.93,0.99,1.03,0.95,1.15,0.90,0.99,1.27,0.98,0.90,0.92,0.78,0.83,0.77,0.84,0.79,0.82,0.86,0.73,0.71,0.73,0.72,0.70,0.73,0.72,0.76,0.81,0.76,0.76,0.82,0.77,0.89,0.85,0.82,0.75,0.80,0.80,0.94,0.88,0.94,0.87,0.95,0.96,0.88,0.72,0.74,0.76,0.83,0.78,0.84,0.79,0.87,0.91,0.83,0.89,0.98,0.92,1.23,1.34,1.05,1.16,0.99,0.96,1.46,1.57,1.54,1.33,1.05,1.26,1.08,1.37,1.10,0.98,1.03,0.92,1.14,0.86,0.95,0.97,0.90,0.89,0.79,0.84,0.77,0.82,0.76,0.82,0.97,0.89,0.98,0.71,0.72,0.74,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.34,1.51,1.53,1.67,1.72,1.71,1.80,1.77,1.91,1.86,1.98,1.86,1.82,1.95,1.89,1.24,1.10,1.41,0.95,0.99,1.09,1.25,1.37,1.63,1.55,0.96,0.98,1.16,1.05,1.00,1.27,1.23,1.50,1.69,1.46,1.86,1.72,1.87,1.24,1.49,1.44,1.69,1.80,1.59,1.69,1.97,1.82,1.94,1.91,1.92,1.99,1.63,1.50,1.74,1.16,1.33,1.38,1.58,1.60,1.77,1.80,1.48,1.21,1.37,0.90,0.97,0.93,1.05,0.97,1.04,1.21,0.99,0.95,1.14,0.92,1.02,1.34,0.94,0.86,0.90,0.74,0.79,0.75,0.81,0.79,0.84,0.86,0.71,0.71,0.73,0.76,0.73,0.77,0.74,0.80,0.85,0.78,0.81,0.89,0.84,0.97,0.92,0.88,0.79,0.85,0.86,0.98,0.92,1.00,0.93,1.06,1.12,0.95,0.74,0.74,0.78,0.79,0.76,0.82,0.79,0.87,0.93,0.85,0.85,0.94,0.90,1.09,1.27,0.99,1.17,1.05,0.96,1.46,1.71,1.62,1.48,1.20,1.34,1.28,1.57,1.35,0.90,0.94,0.85,0.98,0.81,0.89,0.89,0.83,0.82,0.75,0.78,0.73,0.77,0.72,0.76,0.89,0.83,0.91,0.71,0.70,0.72,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00},
			{1.26,1.39,1.48,1.51,1.64,1.71,1.60,1.58,1.77,1.74,1.91,1.94,1.87,1.97,1.85,1.10,0.97,1.22,0.88,0.92,0.95,1.01,1.11,1.39,1.32,0.88,0.90,0.97,0.96,0.93,1.05,0.99,1.27,1.47,1.20,1.70,1.54,1.76,1.08,1.31,1.33,1.70,1.76,1.55,1.57,1.88,1.85,1.91,1.97,1.99,1.99,1.70,1.65,1.85,1.41,1.54,1.61,1.76,1.80,1.91,1.93,1.52,1.26,1.48,0.92,0.99,0.97,1.18,1.09,1.28,1.39,0.94,0.93,1.05,0.92,1.01,1.31,0.88,0.81,0.86,0.72,0.75,0.74,0.79,0.79,0.86,0.85,0.71,0.73,0.75,0.82,0.77,0.83,0.78,0.85,0.88,0.81,0.88,0.97,0.90,1.18,1.00,0.93,0.86,0.92,0.94,1.14,0.99,1.24,1.03,1.33,1.39,1.11,0.79,0.77,0.84,0.79,0.77,0.84,0.83,0.90,0.98,0.91,0.85,0.92,0.91,1.02,1.26,1.00,1.23,1.19,0.99,1.50,1.84,1.71,1.64,1.38,1.46,1.51,1.76,1.59,0.84,0.88,0.80,0.94,0.79,0.86,0.82,0.77,0.76,0.74,0.74,0.71,0.73,0.70,0.72,0.82,0.77,0.85,0.74,0.70,0.73,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00,1.00}
		};
		m_anorms_dots = &anorms_dots[0][0]; 
		m_anorms = &anorms[0][0];
		shadedots = m_anorms_dots;
	

	}


	Md2Model::~Md2Model(){
		delete [] m_vertices;
		delete [] m_glcmds;
		delete [] m_lightnormals;
	}
			
	
	// ----------------------------------------------
	// LoadModel() - load model from file.
	// ----------------------------------------------

	bool Md2Model::LoadModel( string filename, string texFileName ){
		FILE	*file;           // file stream
		sMd2Header           header;         // md2 header
		char            *buffer;        // buffer storing frame data
		frame_t         *frame;         // temporary variable
//		vec3_t          *ptrverts;      // pointer on m_vertices
//		int             *ptrnormals;    // pointer on m_lightnormals
		
		name = filename;
		// try to open filename
		file=fopen( filename.c_str(), "rb" );
		if( !file ){
			cerr << "File " << filename << " not found!" << endl;
			return false;
		}

		// read header file
		fread( (char *)&header, sizeof( sMd2Header ),1,file );
		
		/////////////////////////////////////////////
		//      verify that this is a MD2 file
		// check for the ident and the version number
		if( (header.ident != MD2_IDENT) && (header.version != MD2_VERSION) ){
			fclose(file);
			return false;
		}
		
		/*cerr << "-----------------------------------------------------------\n" <<
				"Numero de Vertices: " << header.num_xyz
				<< "/nNumero Coordenadas de Textura: " << header.num_st << endl <<
		"-----------------------------------------------------------\n";*/
		/////////////////////////////////////////////
		MaterialInfo material=LoadSkin(texFileName.c_str());
		// initialize member variables
 		num_frames  = header.num_frames;
 		num_xyz     = header.num_xyz;
 		num_glcmds  = header.num_glcmds;

		// allocate memory
// 		m_vertices      = new vec3_t[ num_xyz * num_frames ];
 		m_glcmds        = new int[ num_glcmds ];
// 		m_lightnormals  = new int[ num_xyz * num_frames ];
		buffer          = new char[ header.num_frames * header.framesize ];

		/////////////////////////////////////////////
		//          reading file data
		// read frame data...
		fseek(file,header.ofs_frames, SEEK_SET );
		fread( (char *)buffer, num_frames * header.framesize, 1, file );

		// read opengl commands...
		fseek( file,header.ofs_glcmds,SEEK_SET );
		fread( (char *)m_glcmds, num_glcmds * sizeof( int ),1,file );
		
		// vertex array initialization
		for( int j = 0; j < num_frames; j++ ){
        		// adjust pointers
			KeyFrame keyFrame;
 			frame       = (frame_t *)&buffer[ header.framesize * j ];
// 			ptrverts    = &m_vertices[ num_xyz * j ];
// 			ptrnormals  = &m_lightnormals[ num_xyz * j ];
			ConcreteMesh *pMesh;
			
			while( int i = *(m_glcmds++) ){
				pMesh = new ConcreteMesh();
				if( i < 0 ){
					pMesh->setDrawMode( GL_TRIANGLE_FAN );
					i = -i;
				}else{
					pMesh->setDrawMode( GL_TRIANGLE_STRIP );
				}
				pMesh->addMaterial(material);
					
				Vertex *vertex;
				float *normal = new float[3];
				for( int j = 0; j < num_xyz; j++ ){
					vertex = new Vertex();
					vertex->setPosition( (frame->verts[j].vertex[0] * frame->scale[0]) + frame->translate[0], (frame->verts[j].vertex[1] * frame->scale[1]) + frame->translate[1], (frame->verts[j].vertex[2] * frame->scale[2]) + frame->translate[2] );
					normal=&m_anorms[frame->verts[j].lightNormalIndex];
					vertex->setNormal(normal[0],normal[1],normal[2]);
//				vertex->setTexCoord([0],[1]);
					pMesh->addVertex(*vertex);
				}
				
				
				for( /* nothing */; i > 0; i--, m_glcmds += 3 ){
					// ptricmds[0] : texture coordinate s
					// ptricmds[1] : texture coordinate t
					// ptricmds[2] : vertex index to render
				}
				
			
			
				for (int j = 0; j < num_glcmds; j += 4){
					cerr << "numero de vertices "<< pMesh->getNumVertex() << endl;
					cerr << "pegando o vertice "<< m_glcmds[j+3] << endl;
					if (m_glcmds[j] < 0){
						pMesh->setDrawMode(InGE_TRIANGLE_FAN);
					}
					pMesh->addDrawIndex( m_glcmds[j+3] );
					vertex = pMesh->getVertex( m_glcmds[j+3] );
					vertex->setTexCoord((float )m_glcmds[j+1],(float )m_glcmds[j+2]);
				
				}
				keyFrame.addMesh(pMesh);
			}
			
			m_vetKeyFrame.push_back(keyFrame);

		}
		/////////////////////////////////////////////
		// free buffer's memory
		delete [] buffer;
		
	
		// close the file and return
		fclose(file);
		return true;
	}

// ----------------------------------------------
// LoadSkin() - load model texture.
// ----------------------------------------------

MaterialInfo Md2Model::LoadSkin( const char *filename ){
	MaterialInfo material;
	material.setTexture(filename);
	
	//m_texid = LoadTexture( filename );
	m_texid = material.getId();
	cout << "Identificação da textura no MD2" << m_texid << endl;//FIXME:Debug
	return material ; // != LoadTexture( "default" ));
}
	
// ----------------------------------------------
// Interpolate() - interpolate and scale vertices
// from the current and the next frame.
// ----------------------------------------------

	void Md2Model::Interpolate( vec3_t *vertlist ){
		for( int i = 0; i < num_xyz ; i++ ){
			vertlist[i][0] = m_vertices[ i + (num_xyz * m_anim.curr_frame) ][0] * m_scale;
			vertlist[i][1] = m_vertices[ i + (num_xyz * m_anim.curr_frame) ][1] * m_scale;
			vertlist[i][2] = m_vertices[ i + (num_xyz * m_anim.curr_frame) ][2] * m_scale;
		}
	}
	

	
// ----------------------------------------------
// RenderFrame() - draw the current model frame
// using OpenGL commands.
// ----------------------------------------------

	void Md2Model::RenderFrame( void ){
		static int i = 0;
/*		cerr << "Erro aki?\n";
		cerr << "Numero Frames: " << m_vetKeyFrame.size() << endl;*/
		i %= m_vetKeyFrame.size();
		for (int j = 0; j < m_vetKeyFrame[i].getNumMesh(); j++){
			m_vetKeyFrame[i].getMesh(j)->render();
		}
		i++;
// 		static vec3_t    vertlist[ MAX_MD2_VERTS ];  // interpolated vertices
// 		int              *ptricmds = m_glcmds;       // pointer on gl commands
// 
// 
// 		// reverse the orientation of front-facing
// 		// polygons because gl command list's triangles
// 		// have clockwise winding
// 		glPushAttrib( GL_POLYGON_BIT );
// 		glFrontFace( GL_CCW );
// 
// 		// enable backface culling
// 		glEnable( GL_CULL_FACE );
// 		glCullFace( GL_FRONT );
// 
// 		//interpolate
// 		Interpolate( vertlist );
// 
// 		cout << "Utilizando a textura no MD2" << m_texid << endl;//FIXME:Debug
// 		
// 		// bind model's texture
// 		glBindTexture( GL_TEXTURE_2D, m_texid );
// 
// 
// 		// draw each triangle!
// 		while( int i = *(ptricmds++) ){
// 			if( i < 0 ){
// 				glBegin( GL_TRIANGLE_FAN );
// 				i = -i;
// 			}else{
// 				glBegin( GL_TRIANGLE_STRIP );
// 			}
// 
// 			for( /* nothing */; i > 0; i--, ptricmds += 3 ){
// 				// ptricmds[0] : texture coordinate s
// 				// ptricmds[1] : texture coordinate t
// 				// ptricmds[2] : vertex index to render

// 				float l = shadedots[ m_lightnormals[ ptricmds[2] ] ];
// 
//             			// set the lighting color
// 				//glColor3f( l * lcolor[0], l * lcolor[1], l * lcolor[2] );
// 
//             			// parse texture coordinates
// 				glTexCoord2f( ((float *)ptricmds)[0], ((float *)ptricmds)[1] );
// 
//             			// parse triangle's normal (for the lighting)
//             			// >>> only needed if using OpenGL lighting
// 				glNormal3fv( &m_anorms[ m_lightnormals[ ptricmds[2] ] ] );
// 
//             			// draw the vertex
// 				//cerr << "("  << vertlist[ ptricmds[2] ][0] << "," << vertlist[ ptricmds[2] ][1]<< "," << vertlist[ ptricmds[2] ][2] << ")"<< endl; 
// 				glVertex3fv( vertlist[ ptricmds[2] ] );
// 			}
// 
// 			glEnd();
// 		}
// 
// 		glDisable( GL_CULL_FACE );
// 		glPopAttrib();
	}
	
	// ----------------------------------------------
	// SetAnim() - initialize m_anim from the specified
	// animation.
	// ----------------------------------------------

	void Md2Model::SetAnim( int type ){
		if( (type < 0) || (type > MAX_ANIMATIONS) )
			type = 0;
		
		m_anim.startframe   = m_animlist[ type ].first_frame;
		m_anim.endframe     = m_animlist[ type ].last_frame;
		m_anim.next_frame   = m_animlist[ type ].first_frame + 1;
		m_anim.fps          = m_animlist[ type ].fps;
		m_anim.type         = type;
	}
	
	// ----------------------------------------------
	// DrawModel() - draw the model.
	// ----------------------------------------------

	void Md2Model::DrawModel( float time ){
		// animate. calculate current frame and next frame
		if( time > 0.0 )
			Animate( time );

		glPushMatrix();
		// rotate the model
		glRotatef( -90.0, 1.0, 0.0, 0.0 );
		glRotatef( -90.0, 0.0, 0.0, 1.0 );

		// render it on the screen
		RenderFrame();
		glPopMatrix();
	}
	
// ----------------------------------------------
// Animate() - calculate the current frame, next
// frame and interpolation percent.
// ----------------------------------------------

	void Md2Model::Animate( float time ){
		m_anim.curr_time = time;

		// calculate current and next frames
		if( m_anim.curr_time - m_anim.old_time > (1.0 / m_anim.fps) )
		{
			m_anim.curr_frame = m_anim.next_frame;
			m_anim.next_frame++;

			if( m_anim.next_frame > m_anim.endframe )
				m_anim.next_frame = m_anim.startframe;

			m_anim.old_time = m_anim.curr_time;
		}

		// prevent having a current/next frame greater
		// than the total number of frames...
		if( m_anim.curr_frame > (num_frames - 1) )
			m_anim.curr_frame = 0;

		if( m_anim.next_frame > (num_frames - 1) )
			m_anim.next_frame = 0;

		m_anim.interpol = m_anim.fps * (m_anim.curr_time - m_anim.old_time);
	}
	
// ----------------------------------------------
// RenderFrame() - draw one frame of the model
// using gl commands.
// ----------------------------------------------

	void Md2Model::DrawFrame( int frame ){
		// set new animation parameters...
		m_anim.startframe   = frame;
		m_anim.endframe     = frame;
		m_anim.next_frame   = frame;
		m_anim.fps          = 1;
		m_anim.type         = -1;

		// draw the model
		DrawModel( 1.0 );
	}
	
	bool Md2Model::getBlend(){
		return false;
	}
	
	string Md2Model::getName(){
		return name;
	}
	
	vector<VolumeInfo *> Md2Model::getVetVolumeInfo(){
		vector<VolumeInfo *> empty;
		return empty;
	}
	
	void Md2Model::setWeapon(IModel*){
	}
	
	void Md2Model::setAnimation(int){
	}
	
	void Md2Model::drawModel(){
		this->DrawModel(1.00f);
	}
}
